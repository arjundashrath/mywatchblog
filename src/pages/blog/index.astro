---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Header from "../../components/Header.astro";
import { SITE_TITLE } from "../../consts";

const posts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<!DOCTYPE html>
<html lang="en">
	<head>
		<BaseHead
			title={`Blog â€” ${SITE_TITLE}`}
			description="All posts from The Wrist Journal"
		/>
	</head>
	<body>
		<Header />
		<main>
			<section class="blog-header">
				<h1>Blog</h1>
				<p>
					Reviews, guides, and stories about watches that won't break
					the bank.
				</p>
			</section>
			<section class="posts-list">
				{
					posts.map((post, i) => (
						<a
							href={`/mywatchblog/blog/${post.id}/`}
							class:list={["post-card", { featured: i === 0 }]}
						>
							{post.data.heroImage && (
								<div class="card-image">
									<Image
										width={i === 0 ? 960 : 480}
										height={i === 0 ? 480 : 270}
										src={post.data.heroImage}
										alt={post.data.title}
									/>
								</div>
							)}
							<div class="card-body">
								<time class="card-date">
									<FormattedDate date={post.data.pubDate} />
								</time>
								<h2 class="card-title">{post.data.title}</h2>
								<p class="card-desc">{post.data.description}</p>
							</div>
						</a>
					))
				}
			</section>
		</main>
		<Footer />
		<style>
			main {
				width: 960px;
				max-width: calc(100% - 2em);
				padding: 2em 1em 4em;
			}

			.blog-header {
				margin-bottom: 2.5em;
			}

			.blog-header h1 {
				margin-bottom: 0.3em;
			}

			.blog-header p {
				color: var(--text-secondary);
				font-size: 1.1rem;
				margin: 0;
			}

			.posts-list {
				display: grid;
				grid-template-columns: repeat(2, 1fr);
				gap: 1.5em;
			}

			.post-card {
				display: flex;
				flex-direction: column;
				background: var(--bg-card);
				border: 1px solid var(--border);
				border-radius: var(--radius);
				overflow: hidden;
				text-decoration: none;
				color: inherit;
				transition: border-color var(--transition),
					box-shadow var(--transition), transform var(--transition);
			}

			.post-card:hover {
				border-color: var(--border-hover);
				box-shadow: var(--shadow-lg);
				transform: translateY(-2px);
				color: inherit;
			}

			.post-card.featured {
				grid-column: 1 / -1;
			}

			.card-image {
				overflow: hidden;
				aspect-ratio: 16 / 9;
			}

			.card-image img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				border-radius: 0;
				transition: transform 0.3s ease;
			}

			.post-card:hover .card-image img {
				transform: scale(1.03);
			}

			.card-body {
				padding: 1.25em 1.5em;
				flex: 1;
			}

			.card-date {
				font-size: 0.8rem;
				color: var(--text-muted);
				text-transform: uppercase;
				letter-spacing: 0.05em;
			}

			.card-title {
				font-size: 1.3rem;
				margin: 0.35em 0 0.4em;
				line-height: 1.3;
			}

			.post-card.featured .card-title {
				font-size: 1.75rem;
			}

			.card-desc {
				font-size: 0.9rem;
				color: var(--text-secondary);
				margin: 0;
				line-height: 1.5;
			}

			@media (max-width: 720px) {
				.posts-list {
					grid-template-columns: 1fr;
				}
				.post-card.featured .card-title {
					font-size: 1.3rem;
				}
			}
		</style>
	</body>
</html>
